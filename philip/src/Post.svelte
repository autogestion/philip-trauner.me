
<script>
	export let post;
	import PostBody from "./PostBody.svelte"

	let fpost;
	let post_object;
	let fetched_post = false;
	if (["Announce", "Like"].includes(post.type)) {
	    if (pubgate_instance == false) {
            fpost = fetch(post.object, { headers: {
                "Accept": "application/activity+json"
            }}).then(d => d.json());
            post_object = fpost => fpost.object;
	    } else {
	        post_object = post.object
	    }

	    fetched_post = true
    }
	console.log(post)
</script>

<style>
    .reaction {
        margin-left: 30px;
    }

</style>

{#if fetched_post == false}
<li class="post">
    <h2 id=""> . </h2>
    <PostBody post={post.object} />
</li>

{:else}
<li class="post">
    <div class="metadata">
        <h2 id=""> . </h2>
        <a href="{post.id}">{post.type}</a> by user <a href="{ post.actor }">{ post.actor.split('/').slice(-1)[0] }</a>
        <span class="metadata-seperator">Â·</span>
        // TODO: catch any undefined inside component
        {#if post.published }
        <span>{ post.published.replace("T", " ").replace("Z", " ") }</span>
        {/if}
    </div>
    <div class="reaction">
        <PostBody post={post_object} />
    </div>
</li>
{/if}
