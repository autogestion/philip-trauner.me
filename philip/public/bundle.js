var app=function(){"use strict";function e(){}function t(e,t){for(const n in t)e[n]=t[n];return e}function n(e){return e()}function o(){return Object.create(null)}function s(e){e.forEach(n)}function r(e){return"function"==typeof e}function c(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function u(e,t,n){e.$$.on_destroy.push(function(e,t){const n=e.subscribe(t);return n.unsubscribe?()=>n.unsubscribe():n}(t,n))}function l(e,t){e.appendChild(t)}function i(e,t,n){e.insertBefore(t,n||null)}function a(e){e.parentNode.removeChild(e)}function p(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function f(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function m(){return d(" ")}function h(){return d("")}function g(e,t,n,o){return e.addEventListener(t,n,o),()=>e.removeEventListener(t,n,o)}function $(e){return function(t){return t.preventDefault(),e.call(this,t)}}function b(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function v(e,t){t=""+t,e.data!==t&&(e.data=t)}let k;function y(e){k=e}function w(e){(function(){if(!k)throw new Error("Function called outside component initialization");return k})().$$.on_destroy.push(e)}function R(){const e=k;return(t,n)=>{const o=e.$$.callbacks[t];if(o){const s=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);o.slice().forEach(t=>{t.call(e,s)})}}}const x=[],_=[],T=[],j=[],S=Promise.resolve();let N=!1;function P(e){T.push(e)}function O(){const e=new Set;do{for(;x.length;){const e=x.shift();y(e),L(e.$$)}for(;_.length;)_.pop()();for(let t=0;t<T.length;t+=1){const n=T[t];e.has(n)||(n(),e.add(n))}T.length=0}while(x.length);for(;j.length;)j.pop()();N=!1}function L(e){e.fragment&&(e.update(e.dirty),s(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(P))}const A=new Set;let U;function C(){U={r:0,c:[],p:U}}function I(){U.r||s(U.c),U=U.p}function E(e,t){e&&e.i&&(A.delete(e),e.i(t))}function J(e,t,n,o){if(e&&e.o){if(A.has(e))return;A.add(e),U.c.push(()=>{A.delete(e),o&&(n&&e.d(1),o())}),e.o(t)}}function D(e,n){const o=n.token={};function s(e,s,r,c){if(n.token!==o)return;n.resolved=r&&{[r]:c};const u=t(t({},n.ctx),n.resolved),l=e&&(n.current=e)(u);n.block&&(n.blocks?n.blocks.forEach((e,t)=>{t!==s&&e&&(C(),J(e,1,1,()=>{n.blocks[t]=null}),I())}):n.block.d(1),l.c(),E(l,1),l.m(n.mount(),n.anchor),O()),n.block=l,n.blocks&&(n.blocks[s]=l)}if((r=e)&&"object"==typeof r&&"function"==typeof r.then){if(e.then(e=>{s(n.then,1,n.value,e)},e=>{s(n.catch,2,n.error,e)}),n.current!==n.pending)return s(n.pending,0),!0}else{if(n.current!==n.then)return s(n.then,1,n.value,e),!0;n.resolved={[n.value]:e}}var r}function F(e,t,o){const{fragment:c,on_mount:u,on_destroy:l,after_update:i}=e.$$;c.m(t,o),P(()=>{const t=u.map(n).filter(r);l?l.push(...t):s(t),e.$$.on_mount=[]}),i.forEach(P)}function q(e,t){e.$$.fragment&&(s(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function z(e,t){e.$$.dirty||(x.push(e),N||(N=!0,S.then(O)),e.$$.dirty=o()),e.$$.dirty[t]=!0}function B(t,n,r,c,u,l){const i=k;y(t);const a=n.props||{},p=t.$$={fragment:null,ctx:null,props:l,update:e,not_equal:u,bound:o(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(i?i.$$.context:[]),callbacks:o(),dirty:null};let f=!1;var d;p.ctx=r?r(t,a,(e,n)=>{p.ctx&&u(p.ctx[e],p.ctx[e]=n)&&(p.bound[e]&&p.bound[e](n),f&&z(t,e))}):a,p.update(),f=!0,s(p.before_update),p.fragment=c(p.ctx),n.target&&(n.hydrate?p.fragment.l((d=n.target,Array.from(d.childNodes))):p.fragment.c(),n.intro&&E(t.$$.fragment),F(t,n.target,n.anchor),O()),y(i)}class W{$destroy(){q(this,1),this.$destroy=e}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function H(t){var n,o,s,r;return{c(){n=f("li"),o=f("a"),s=d(t.name),b(o,"href",t.path),b(o,"class","svelte-kazhwj"),r=g(o,"click",$(t.redirectTo))},m(e,t){i(e,n,t),l(n,o),l(o,s)},p(e,t){e.path&&b(o,"href",t.path)},i:e,o:e,d(e){e&&a(n),r()}}}function M(e,t,n){let{selectTab:o,curRoute:s,routes:r,path:c}=t,u=window.location.origin+c,l=r[c].name;return e.$set=(e=>{"selectTab"in e&&n("selectTab",o=e.selectTab),"curRoute"in e&&n("curRoute",s=e.curRoute),"routes"in e&&n("routes",r=e.routes),"path"in e&&n("path",c=e.path)}),{selectTab:o,curRoute:s,routes:r,path:c,name:l,redirectTo:function(e){o(e.target);const t=e.target.pathname;s.set(t),window.history.pushState({path:t},"",u)}}}class G extends W{constructor(e){super(),B(this,e,M,H,c,["selectTab","curRoute","routes","path"])}}function Y(e){var t,n,o=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/local"}}),s=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/federated"}});return{c(){o.$$.fragment.c(),t=m(),s.$$.fragment.c()},m(e,r){F(o,e,r),i(e,t,r),F(s,e,r),n=!0},p(e,t){var n={};e.curRoute&&(n.curRoute=t.curRoute),e.selectTab&&(n.selectTab=t.selectTab),e.routes&&(n.routes=t.routes),o.$set(n);var r={};e.curRoute&&(r.curRoute=t.curRoute),e.selectTab&&(r.selectTab=t.selectTab),e.routes&&(r.routes=t.routes),s.$set(r)},i(e){n||(E(o.$$.fragment,e),E(s.$$.fragment,e),n=!0)},o(e){J(o.$$.fragment,e),J(s.$$.fragment,e),n=!1},d(e){q(o,e),e&&a(t),q(s,e)}}}function Z(e){var t,n,o,s=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/inbox"}}),r=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/create"}}),c=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/search"}});return{c(){s.$$.fragment.c(),t=m(),r.$$.fragment.c(),n=m(),c.$$.fragment.c()},m(e,u){F(s,e,u),i(e,t,u),F(r,e,u),i(e,n,u),F(c,e,u),o=!0},p(e,t){var n={};e.curRoute&&(n.curRoute=t.curRoute),e.selectTab&&(n.selectTab=t.selectTab),e.routes&&(n.routes=t.routes),s.$set(n);var o={};e.curRoute&&(o.curRoute=t.curRoute),e.selectTab&&(o.selectTab=t.selectTab),e.routes&&(o.routes=t.routes),r.$set(o);var u={};e.curRoute&&(u.curRoute=t.curRoute),e.selectTab&&(u.selectTab=t.selectTab),e.routes&&(u.routes=t.routes),c.$set(u)},i(e){o||(E(s.$$.fragment,e),E(r.$$.fragment,e),E(c.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),J(r.$$.fragment,e),J(c.$$.fragment,e),o=!1},d(e){q(s,e),e&&a(t),q(r,e),e&&a(n),q(c,e)}}}function K(e){var t,n,o,s,r,c,u=1==e.pgi&&Y(e),p=e.$session.user&&Z(e),d=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/profile"}}),h=new G({props:{curRoute:e.curRoute,selectTab:e.selectTab,routes:e.routes,path:"/about"}});return{c(){t=f("header"),n=f("ul"),u&&u.c(),o=m(),p&&p.c(),s=m(),d.$$.fragment.c(),r=m(),h.$$.fragment.c(),b(t,"id","navigation")},m(e,a){i(e,t,a),l(t,n),u&&u.m(n,null),l(n,o),p&&p.m(n,null),l(n,s),F(d,n,null),l(n,r),F(h,n,null),c=!0},p(e,t){1==t.pgi?u?(u.p(e,t),E(u,1)):((u=Y(t)).c(),E(u,1),u.m(n,o)):u&&(C(),J(u,1,1,()=>{u=null}),I()),t.$session.user?p?(p.p(e,t),E(p,1)):((p=Z(t)).c(),E(p,1),p.m(n,s)):p&&(C(),J(p,1,1,()=>{p=null}),I());var r={};e.curRoute&&(r.curRoute=t.curRoute),e.selectTab&&(r.selectTab=t.selectTab),e.routes&&(r.routes=t.routes),d.$set(r);var c={};e.curRoute&&(c.curRoute=t.curRoute),e.selectTab&&(c.selectTab=t.selectTab),e.routes&&(c.routes=t.routes),h.$set(c)},i(e){c||(E(u),E(p),E(d.$$.fragment,e),E(h.$$.fragment,e),c=!0)},o(e){J(u),J(p),J(d.$$.fragment,e),J(h.$$.fragment,e),c=!1},d(e){e&&a(t),u&&u.d(),p&&p.d(),q(d),q(h)}}}function Q(e,t,n){let o,{routes:s,curRoute:r,selectTab:c,pgi:l,session:i}=t;return u(e,i,e=>{n("$session",o=e)}),e.$set=(e=>{"routes"in e&&n("routes",s=e.routes),"curRoute"in e&&n("curRoute",r=e.curRoute),"selectTab"in e&&n("selectTab",c=e.selectTab),"pgi"in e&&n("pgi",l=e.pgi),"session"in e&&n("session",i=e.session)}),{routes:s,curRoute:r,selectTab:c,pgi:l,session:i,$session:o}}class V extends W{constructor(e){super(),B(this,e,Q,K,c,["routes","curRoute","selectTab","pgi","session"])}}function X(t){var n,o,s;return{c(){n=f("hr"),o=m(),(s=f("footer")).innerHTML='<div class="left-column"><h3>PubGate-Philip</h3></div>',b(n,"class","separator"),b(s,"class","content")},m(e,t){i(e,n,t),i(e,o,t),i(e,s,t)},p:e,i:e,o:e,d(e){e&&(a(n),a(o),a(s))}}}class ee extends W{constructor(e){super(),B(this,e,null,X,c,[])}}function te(e,t={},n="application/activity+json"){let o={headers:{Accept:n}};return fetch(e,Object.assign(o,t)).then(e=>e.json()).catch(t=>(console.log(t),console.log("fetching"),fetch(base_url+"/proxy",{method:"POST",body:JSON.stringify({url:e})}).then(e=>e.json()).catch(e=>{console.log(e)})))}const ne=function(e,t={},n=!1){let o={Accept:"application/activity+json"};return t.user&&n&&(o.Authorization="Bearer "+t.token),fetch(e,{headers:o}).then(e=>e.json()).then(e=>e)};let oe,se;const re=base_url.match(/^([^:]+):\/\/([^\/]+)/);re&&(oe=re[1],se=re[2]);const ce=(e,t=se,n=!0)=>{return`${t===se?oe:"https"}://${t}/`+(n?`@${e}`:`.well-known/webfinger?resource=acc:${e}@${t}`)},ue=async(e,t)=>{const n=!!pubgate_instance,o=await le(ce(e,t),n);if(console.log("fyn",o),o&&!o.error)return o;const s=await le(ce(e,t,!1),n);if(console.log("wf",s),!s||s.error)return s;const r=s.aliases[1]||s.links[0].href;return await le(r,n)},le=async(e,t=!0)=>{if(t){const t={method:"POST",body:JSON.stringify({url:e})};return await fetch(base_url+"/proxy",t).then(e=>e.json())}try{const t={Accept:"application/activity+json"};return await fetch(e,t).then(e=>e.json())}catch(e){return{error:e}}},ie=async e=>{const t={method:"POST",body:JSON.stringify({url:e})},n=await fetch(base_url+"/proxy",t).then(e=>e.json());return n.error?n:"string"==typeof n.first?await ae(n.first):n.first},ae=async e=>{JSON.stringify({url:e});return await fetch(base_url+"/proxy",request).then(e=>e.json())};function pe(e,t,n){const o=Object.create(e);return o.attachment=t[n],o}function fe(e){var t,n;return{c(){t=f("a"),n=d("Original post"),b(t,"class","original svelte-66q9dc"),b(t,"href",e.post)},m(e,o){i(e,t,o),l(t,n)},p(e,n){e.post&&b(t,"href",n.post)},d(e){e&&a(t)}}}function de(e){var t,n,o,s=e.post.content,r=e.post.attachment&&me(e);return{c(){t=f("p"),n=m(),r&&r.c(),o=h()},m(e,c){i(e,t,c),t.innerHTML=s,i(e,n,c),r&&r.m(e,c),i(e,o,c)},p(e,n){e.post&&s!==(s=n.post.content)&&(t.innerHTML=s),n.post.attachment?r?r.p(e,n):((r=me(n)).c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},d(e){e&&(a(t),a(n)),r&&r.d(e),e&&a(o)}}}function me(e){for(var t,n=e.post.attachment,o=[],s=0;s<n.length;s+=1)o[s]=ge(pe(e,n,s));return{c(){for(var e=0;e<o.length;e+=1)o[e].c();t=h()},m(e,n){for(var s=0;s<o.length;s+=1)o[s].m(e,n);i(e,t,n)},p(e,s){if(e.post){n=s.post.attachment;for(var r=0;r<n.length;r+=1){const c=pe(s,n,r);o[r]?o[r].p(e,c):(o[r]=ge(c),o[r].c(),o[r].m(t.parentNode,t))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(e){p(o,e),e&&a(t)}}}function he(e){var t,n;return{c(){b(t=f("img"),"src",n=e.attachment.url),b(t,"alt","image")},m(e,n){i(e,t,n)},p(e,o){e.post&&n!==(n=o.attachment.url)&&b(t,"src",n)},d(e){e&&a(t)}}}function ge(e){var t,n="Document"===e.attachment.type&&e.attachment.mediaType.startsWith("image")&&he(e);return{c(){n&&n.c(),t=h()},m(e,o){n&&n.m(e,o),i(e,t,o)},p(e,o){"Document"===o.attachment.type&&o.attachment.mediaType.startsWith("image")?n?n.p(e,o):((n=he(o)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&a(t)}}}function $e(t){var n;function o(e){return e.post.id?de:fe}var s=o(t),r=s(t);return{c(){r.c(),n=h()},m(e,t){r.m(e,t),i(e,n,t)},p(e,t){s===(s=o(t))&&r?r.p(e,t):(r.d(1),(r=s(t))&&(r.c(),r.m(n.parentNode,n)))},i:e,o:e,d(e){r.d(e),e&&a(n)}}}function be(e,t,n){let{post:o}=t;return e.$set=(e=>{"post"in e&&n("post",o=e.post)}),{post:o}}class ve extends W{constructor(e){super(),B(this,e,be,$e,c,["post"])}}function ke(t){var n,o,s,r,c,u,p,h,g,$,k,y,w=t.post.type,R=t.post.published.replace("T"," ").replace("Z"," ");return{c(){n=f("div"),o=f("a"),s=d(w),c=d("\n  by\n  "),u=f("a"),p=d(t.userName),h=m(),(g=f("span")).textContent="·",$=m(),k=f("span"),y=d(R),b(o,"href",r=t.post.id),b(u,"href",t.userId),b(g,"class","metadata-seperator"),b(n,"class","metadata")},m(e,t){i(e,n,t),l(n,o),l(o,s),l(n,c),l(n,u),l(u,p),l(n,h),l(n,g),l(n,$),l(n,k),l(k,y)},p(e,t){e.post&&w!==(w=t.post.type)&&v(s,w),e.post&&r!==(r=t.post.id)&&b(o,"href",r),e.userId&&b(u,"href",t.userId),e.post&&R!==(R=t.post.published.replace("T"," ").replace("Z"," "))&&v(y,R)},i:e,o:e,d(e){e&&a(n)}}}function ye(e,t,n){let{post:o}=t,s=o.hasOwnProperty("actor")?o.actor:o.attributedTo;"string"!=typeof s&&n("userId",s=s[0]);const r=s.replace(/^.+\@([^\/@]+)$/,"$1");return e.$set=(e=>{"post"in e&&n("post",o=e.post)}),{post:o,userId:s,userName:r}}class we extends W{constructor(e){super(),B(this,e,ye,ke,c,["post"])}}function Re(e,t,n){const o=Object.create(e);return o.tag=t[n],o}function xe(e){for(var t,n=e.tags,o=[],s=0;s<n.length;s+=1)o[s]=Te(Re(e,n,s));return{c(){t=f("div");for(var e=0;e<o.length;e+=1)o[e].c();b(t,"class","tags")},m(e,n){i(e,t,n);for(var s=0;s<o.length;s+=1)o[s].m(t,null)},p(e,s){if(e.tags){n=s.tags;for(var r=0;r<n.length;r+=1){const c=Re(s,n,r);o[r]?o[r].p(e,c):(o[r]=Te(c),o[r].c(),o[r].m(t,null))}for(;r<o.length;r+=1)o[r].d(1);o.length=n.length}},d(e){e&&a(t),p(o,e)}}}function _e(e){var t,n,o,s=e.tag.name;return{c(){t=f("a"),n=d(s),b(t,"class","tag"),b(t,"href",o=e.tag.href)},m(e,o){i(e,t,o),l(t,n)},p(e,r){e.tags&&s!==(s=r.tag.name)&&v(n,s),e.tags&&o!==(o=r.tag.href)&&b(t,"href",o)},d(e){e&&a(t)}}}function Te(e){var t,n="Hashtag"==e.tag.type&&_e(e);return{c(){n&&n.c(),t=h()},m(e,o){n&&n.m(e,o),i(e,t,o)},p(e,o){"Hashtag"==o.tag.type?n?n.p(e,o):((n=_e(o)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},d(e){n&&n.d(e),e&&a(t)}}}function je(t){var n,o=t.tags&&xe(t);return{c(){o&&o.c(),n=h()},m(e,t){o&&o.m(e,t),i(e,n,t)},p(e,t){t.tags?o?o.p(e,t):((o=xe(t)).c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},i:e,o:e,d(e){o&&o.d(e),e&&a(n)}}}function Se(e,t,n){let{tags:o}=t;return e.$set=(e=>{"tags"in e&&n("tags",o=e.tags)}),{tags:o}}class Ne extends W{constructor(e){super(),B(this,e,Se,je,c,["tags"])}}const Pe=e=>({name:e,href:"",type:"Hashtag"}),Oe=(e,t)=>({name:e,href:t,type:"Mention"}),Le=(e,t)=>({type:"Create",object:{type:"Note",attachment:[],tag:t,content:e}});function Ae(t){var n,o,r,c,u,p,h,$,k,y,w;return{c(){n=f("form"),o=f("fieldset"),r=f("textarea"),c=m(),u=f("button"),p=d("Publish"),$=m(),k=f("p"),y=d(t.error),b(r,"class","form-control svelte-1fvj4fs"),b(r,"placeholder","Write your text here"),b(o,"class","form-group"),b(u,"class","btn btn-sm pull-xs-right btn-info"),u.disabled=h=!t.content||t.inProgress,b(k,"class","text-danger"),w=[g(r,"input",t.textarea_input_handler),g(n,"submit",t.publish)]},m(e,s){i(e,n,s),l(n,o),l(o,r),r.value=t.content,l(n,c),l(n,u),l(u,p),i(e,$,s),i(e,k,s),l(k,y)},p(e,t){e.content&&(r.value=t.content),(e.content||e.inProgress)&&h!==(h=!t.content||t.inProgress)&&(u.disabled=h),e.error&&v(y,t.error)},i:e,o:e,d(e){e&&(a(n),a($),a(k)),s(w)}}}const Ue=/(^|\W)(#[^#\s]+)/gi,Ce=/(^|\W)@([^@\s]+)(@([^@\s]+))?/gi;function Ie(e,t,n){let o,{reply:s=null,session:r,curRoute:c}=t;u(e,r,e=>{n("$session",o=e)});let l=!1,i="",a="";const p=async e=>{try{const t={method:"POST",body:e,headers:{Authorization:"Bearer "+o.token}};console.log("sending",t);const s=await fetch(o.user.outbox,t).then(e=>e.json());console.log("response",s),s.error?n("error",a=s.error):"success"!==s.Created&&n("error",a="Failed to create post: "+JSON.stringify(s))}catch(e){n("error",a=e)}n("inProgress",l=!1),n("content",i="")};return e.$set=(e=>{"reply"in e&&n("reply",s=e.reply),"session"in e&&n("session",r=e.session),"curRoute"in e&&n("curRoute",c=e.curRoute)}),{reply:s,session:r,curRoute:c,inProgress:l,content:i,error:a,publish:e=>{e.preventDefault(),n("inProgress",l=!0);const t=(e=>e.match(Ue)||[])(i).map(e=>e.trim()).map(Pe);n("content",i=(e=>e.replace(Ue,'$1<a href="" rel="tag">$2</a>'))((e=>e.replace(/( https?:\/\/([^\s]+))/gi,'<a href="$1">$2</a>'))(i)));const r=(e=>[...e.matchAll(Ce)]||[])(i).map(e=>{const t=e[0],o=e[2],s=e[4],r=ce(o,s),c=`${e[1]}<span class='h-card'><a href="${r}"' class='u-url mention'>@<span>${o}</span></a></span>`;return n("content",i=i.replace(t,c)),Oe(o,r)});let c=Le(i,t.concat(r));c.cc=r.map(e=>e.href),s&&(c.object.inReplyTo=s.id,s.attributedTo!==o.user.url&&(c.cc=c.cc.concat(s.attributedTo))),p(JSON.stringify(c))},textarea_input_handler:function(){i=this.value,n("content",i)}}}class Ee extends W{constructor(e){super(),B(this,e,Ie,Ae,c,["reply","session","curRoute"])}}function Je(e){var n,o,s,r,c,u,p,d,h,g,$,v,k,y=new we({props:{post:e.post}}),w=new Ne({props:{tags:e.tags}}),R=new ve({props:{post:e.post}});let x={ctx:e,current:null,token:null,pending:ze,then:qe,catch:Fe,value:"likes",error:"null"};D(u=e.likes,x);let _={ctx:e,current:null,token:null,pending:He,then:We,catch:Be,value:"comments",error:"null"};D(d=e.comments,_);let T={ctx:e,current:null,token:null,pending:Ye,then:Ge,catch:Me,value:"announces",error:"null"};D(g=e.announces,T);var j=e.$session.user&&Ze(e),S=!e.skip_comments&&Xe(e);return{c(){y.$$.fragment.c(),n=m(),w.$$.fragment.c(),o=m(),R.$$.fragment.c(),s=m(),r=f("div"),c=f("div"),x.block.c(),p=m(),_.block.c(),h=m(),T.block.c(),$=m(),j&&j.c(),v=m(),S&&S.c(),b(c,"class","rs svelte-vekltv")},m(e,t){F(y,e,t),i(e,n,t),F(w,e,t),i(e,o,t),F(R,e,t),i(e,s,t),i(e,r,t),l(r,c),x.block.m(c,x.anchor=null),x.mount=(()=>c),x.anchor=p,l(c,p),_.block.m(c,_.anchor=null),_.mount=(()=>c),_.anchor=h,l(c,h),T.block.m(c,T.anchor=null),T.mount=(()=>c),T.anchor=null,l(r,$),j&&j.m(r,null),l(r,v),S&&S.m(r,null),k=!0},p(n,o){e=o;var s={};n.post&&(s.post=e.post),y.$set(s);var c={};n.tags&&(c.tags=e.tags),w.$set(c);var l={};n.post&&(l.post=e.post),R.$set(l),x.ctx=e,u!==(u=e.likes)&&D(u,x)||x.block.p(n,t(t({},e),x.resolved)),_.ctx=e,d!==(d=e.comments)&&D(d,_)||_.block.p(n,t(t({},e),_.resolved)),T.ctx=e,g!==(g=e.announces)&&D(g,T)||T.block.p(n,t(t({},e),T.resolved)),e.$session.user?j?(j.p(n,e),E(j,1)):((j=Ze(e)).c(),E(j,1),j.m(r,v)):j&&(C(),J(j,1,1,()=>{j=null}),I()),e.skip_comments?S&&(C(),J(S,1,1,()=>{S=null}),I()):S?(S.p(n,e),E(S,1)):((S=Xe(e)).c(),E(S,1),S.m(r,null))},i(e){k||(E(y.$$.fragment,e),E(w.$$.fragment,e),E(R.$$.fragment,e),E(j),E(S),k=!0)},o(e){J(y.$$.fragment,e),J(w.$$.fragment,e),J(R.$$.fragment,e),J(j),J(S),k=!1},d(e){q(y,e),e&&a(n),q(w,e),e&&a(o),q(R,e),e&&(a(s),a(r)),x.block.d(),x.token=null,x=null,_.block.d(),_.token=null,_=null,T.block.d(),T.token=null,T=null,j&&j.d(),S&&S.d()}}}function De(t){var n,o;return{c(){n=f("a"),o=d(t.post),b(n,"href",t.post)},m(e,t){i(e,n,t),l(n,o)},p(e,t){e.post&&(v(o,t.post),b(n,"href",t.post))},i:e,o:e,d(e){e&&a(n)}}}function Fe(t){return{c:e,m:e,p:e,d:e}}function qe(t){var n,o,s,r,c=t.likes;return{c(){n=f("span"),o=d(c),s=d(" likes"),b(n,"class","rs_left svelte-vekltv"),r=g(n,"click",t.toggleLists)},m(e,t){i(e,n,t),l(n,o),l(n,s)},p:e,d(e){e&&a(n),r()}}}function ze(t){return{c:e,m:e,p:e,d:e}}function Be(t){return{c:e,m:e,p:e,d:e}}function We(t){var n,o,s,r,c=null!==t.comments.totalItems?t.comments.totalItems:t.comments;return{c(){n=f("span"),o=d(c),s=d(" comments"),b(n,"class","rs_right svelte-vekltv"),r=g(n,"click",t.toggleLists)},m(e,t){i(e,n,t),l(n,o),l(n,s)},p:e,d(e){e&&a(n),r()}}}function He(t){return{c:e,m:e,p:e,d:e}}function Me(t){return{c:e,m:e,p:e,d:e}}function Ge(t){var n,o,s,r,c=t.announces;return{c(){n=f("span"),o=d(c),s=d(" announces"),b(n,"class","rs_right svelte-vekltv"),r=g(n,"click",t.toggleLists)},m(e,t){i(e,n,t),l(n,o),l(n,s)},p:e,d(e){e&&a(n),r()}}}function Ye(t){return{c:e,m:e,p:e,d:e}}function Ze(e){var t,n,o,r,c,u,p,$,v,k,y,w,R=e.liked&&Ke(),x=e.announced&&Qe(),_=e.showPublish&&Ve(e);return{c(){t=f("div"),n=f("button"),o=d("Like"),R&&R.c(),r=m(),(c=f("button")).textContent="Add comment",u=m(),p=f("button"),$=d("Announce"),x&&x.c(),v=m(),_&&_.c(),k=h(),b(n,"class","btn btn-dark ra_item svelte-vekltv"),b(c,"class","btn btn-dark ra_item svelte-vekltv"),b(p,"class","btn btn-dark ra_item svelte-vekltv"),b(t,"class","ra svelte-vekltv"),w=[g(n,"click",e.doLike),g(c,"click",e.togglePublish),g(p,"click",e.doAnnounce)]},m(e,s){i(e,t,s),l(t,n),l(n,o),R&&R.m(n,null),l(t,r),l(t,c),l(t,u),l(t,p),l(p,$),x&&x.m(p,null),i(e,v,s),_&&_.m(e,s),i(e,k,s),y=!0},p(e,t){t.liked?R||((R=Ke()).c(),R.m(n,null)):R&&(R.d(1),R=null),t.announced?x||((x=Qe()).c(),x.m(p,null)):x&&(x.d(1),x=null),t.showPublish?_?(_.p(e,t),E(_,1)):((_=Ve(t)).c(),E(_,1),_.m(k.parentNode,k)):_&&(C(),J(_,1,1,()=>{_=null}),I())},i(e){y||(E(_),y=!0)},o(e){J(_),y=!1},d(e){e&&a(t),R&&R.d(),x&&x.d(),e&&a(v),_&&_.d(e),e&&a(k),s(w)}}}function Ke(e){var t;return{c(){t=d("d")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function Qe(e){var t;return{c(){t=d("d")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function Ve(e){var t,n=new Ee({props:{reply:e.post,session:e.session}});return{c(){n.$$.fragment.c()},m(e,o){F(n,e,o),t=!0},p(e,t){var o={};e.post&&(o.reply=t.post),e.session&&(o.session=t.session),n.$set(o)},i(e){t||(E(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){q(n,e)}}}function Xe(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:ot,then:tt,catch:et,value:"collection",error:"null",blocks:[,,,]};return D(o=e.comments,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,o!==(o=e.comments)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(E(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){J(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}function et(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function tt(e){var t,n,o=e.collection.totalItems&&nt(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.totalItems?o?(o.p(e,n),E(o,1)):((o=nt(n)).c(),E(o,1),o.m(t.parentNode,t)):o&&(C(),J(o,1,1,()=>{o=null}),I())},i(e){n||(E(o),n=!0)},o(e){J(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function nt(e){var t,n,o=new _t({props:{collection:e.collection,session:e.session,content:rt}});return{c(){t=f("div"),o.$$.fragment.c(),b(t,"class","comments svelte-vekltv")},m(e,s){i(e,t,s),F(o,t,null),n=!0},p(e,t){var n={};e.comments&&(n.collection=t.collection),e.session&&(n.session=t.session),e.content&&(n.content=rt),o.$set(n)},i(e){n||(E(o.$$.fragment,e),n=!0)},o(e){J(o.$$.fragment,e),n=!1},d(e){e&&a(t),q(o)}}}function ot(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function st(e){var t,n,o,s,r=[De,Je],c=[];function u(e){return e.isID?0:1}return t=u(e),n=c[t]=r[t](e),{c(){n.c(),o=h()},m(e,n){c[t].m(e,n),i(e,o,n),s=!0},p(e,s){var l=t;(t=u(s))===l?c[t].p(e,s):(C(),J(c[l],1,1,()=>{c[l]=null}),I(),(n=c[t])||(n=c[t]=r[t](s)).c(),E(n,1),n.m(o.parentNode,o))},i(e){s||(E(n),s=!0)},o(e){J(n),s=!1},d(e){c[t].d(e),e&&a(o)}}}let rt="replies";function ct(e,t,n){let o,{post:s,session:r}=t;u(e,r,e=>{n("$session",o=e)});let c,l=pubgate_instance,i=!1,a="string"==typeof s;!a&&s.type.startsWith("To")&&n("skip_comments",c=!0);let p=s.tag;const f=async(e,t=!1)=>{if(!e)return"n/a";const n="string"!=typeof e||l?e:await(e=>{return fetch(e,{headers:{Accept:"application/activity+json"}}).then(e=>e.json()).then(e=>e)})(e);return t?n:n.totalItems};let d,m,h=f(s.likes),g=f(s.replies,!0),$=f(s.shares);return o.user&&(s.reactions&&s.reactions.Like&&s.reactions.Like[o.user.name]&&n("liked",d=!0),s.reactions&&s.reactions.Announce&&s.reactions.Announce[o.user.name]&&n("announced",m=!0)),e.$set=(e=>{"post"in e&&n("post",s=e.post),"session"in e&&n("session",r=e.session)}),{post:s,session:r,showPublish:i,isID:a,skip_comments:c,tags:p,togglePublish:e=>{e.preventDefault(),n("showPublish",i=!i)},toggleLists:e=>{e.preventDefault()},likes:h,comments:g,announces:$,liked:d,announced:m,doLike:async function(e){if(e.preventDefault(),!d){let e={type:"Like",object:s.id,cc:[s.attributedTo]};await fetch(o.user.outbox,{method:"POST",body:JSON.stringify(e),headers:{Authorization:"Bearer "+o.token}}).then(e=>e.json()),n("liked",d=!0)}},doAnnounce:async function(e){if(e.preventDefault(),!m){let e={type:"Announce",object:s.id,cc:[s.attributedTo]};await fetch(o.user.outbox,{method:"POST",body:JSON.stringify(e),headers:{Authorization:"Bearer "+o.token}}).then(e=>e.json()),n("announced",m=!0)}},$session:o}}class ut extends W{constructor(e){super(),B(this,e,ct,st,c,["post","session"])}}function lt(e){var t,n,o,s,r,c,u=[ft,pt,at],l=[];function p(e){return e.isReaction?0:e.isReply?1:2}return o=p(e),s=l[o]=u[o](e),{c(){(t=f("h2")).textContent=".",n=m(),s.c(),r=h(),b(t,"id","")},m(e,s){i(e,t,s),i(e,n,s),l[o].m(e,s),i(e,r,s),c=!0},p(e,t){var n=o;(o=p(t))===n?l[o].p(e,t):(C(),J(l[n],1,1,()=>{l[n]=null}),I(),(s=l[o])||(s=l[o]=u[o](t)).c(),E(s,1),s.m(r.parentNode,r))},i(e){c||(E(s),c=!0)},o(e){J(s),c=!1},d(e){e&&(a(t),a(n)),l[o].d(e),e&&a(r)}}}function it(e){var t,n,o=new ut({props:{post:e.post.object,session:e.session}});return{c(){t=f("div"),o.$$.fragment.c(),b(t,"class","reaction svelte-fh8bnq")},m(e,s){i(e,t,s),F(o,t,null),n=!0},p(e,t){var n={};e.post&&(n.post=t.post.object),e.session&&(n.session=t.session),o.$set(n)},i(e){n||(E(o.$$.fragment,e),n=!0)},o(e){J(o.$$.fragment,e),n=!1},d(e){e&&a(t),q(o)}}}function at(e){var t,n=new ut({props:{post:e.post.object,session:e.session}});return{c(){n.$$.fragment.c()},m(e,o){F(n,e,o),t=!0},p(e,t){var o={};e.post&&(o.post=t.post.object),e.session&&(o.session=t.session),n.$set(o)},i(e){t||(E(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){q(n,e)}}}function pt(e){var t,n,o,s=new ut({props:{post:e.postObject,session:e.session}}),r=new ut({props:{post:e.postObject.inReplyTo,session:e.session}});return{c(){s.$$.fragment.c(),t=m(),n=f("div"),r.$$.fragment.c(),b(n,"class","reaction svelte-fh8bnq")},m(e,c){F(s,e,c),i(e,t,c),i(e,n,c),F(r,n,null),o=!0},p(e,t){var n={};e.postObject&&(n.post=t.postObject),e.session&&(n.session=t.session),s.$set(n);var o={};e.postObject&&(o.post=t.postObject.inReplyTo),e.session&&(o.session=t.session),r.$set(o)},i(e){o||(E(s.$$.fragment,e),E(r.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),J(r.$$.fragment,e),o=!1},d(e){q(s,e),e&&(a(t),a(n)),q(r)}}}function ft(e){var t,n,o,s=new we({props:{post:e.post}}),r=new ut({props:{post:e.postObject,session:e.session}});return{c(){s.$$.fragment.c(),t=m(),n=f("div"),r.$$.fragment.c(),b(n,"class","reaction svelte-fh8bnq")},m(e,c){F(s,e,c),i(e,t,c),i(e,n,c),F(r,n,null),o=!0},p(e,t){var n={};e.post&&(n.post=t.post),s.$set(n);var o={};e.postObject&&(o.post=t.postObject),e.session&&(o.session=t.session),r.$set(o)},i(e){o||(E(s.$$.fragment,e),E(r.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),J(r.$$.fragment,e),o=!1},d(e){q(s,e),e&&(a(t),a(n)),q(r)}}}function dt(e){var t,n,o,s,r=[it,lt],c=[];function u(e){return"replies"==e.content?0:1}return n=u(e),o=c[n]=r[n](e),{c(){t=f("li"),o.c(),b(t,"class","post")},m(e,o){i(e,t,o),c[n].m(t,null),s=!0},p(e,s){var l=n;(n=u(s))===l?c[n].p(e,s):(C(),J(c[l],1,1,()=>{c[l]=null}),I(),(o=c[n])||(o=c[n]=r[n](s)).c(),E(o,1),o.m(t,null))},i(e){s||(E(o),s=!0)},o(e){J(o),s=!1},d(e){e&&a(t),c[n].d()}}}function mt(e,t,n){let o,s,r,{post:c,session:u,content:l}=t,i=pubgate_instance;return"replies"==l?(c.object.type="Reply",n("post",c)):(["Announce","Like"].includes(c.type)||c.object.inReplyTo)&&(n("postObject",o=i?c.object:function(e){if("string"==typeof e){let t;return t=te(e),e=>e.object}return e}(c.object)),["Announce","Like"].includes(c.type)?n("isReaction",r=!0):o.inReplyTo&&(n("isReply",s=!0),o.type="Reply",n("postObject",o),"string"!=typeof o.inReplyTo&&(o.inReplyTo.type="To "+o.inReplyTo.type,n("postObject",o)))),e.$set=(e=>{"post"in e&&n("post",c=e.post),"session"in e&&n("session",u=e.session),"content"in e&&n("content",l=e.content)}),{post:c,session:u,content:l,postObject:o,isReply:s,isReaction:r}}class ht extends W{constructor(e){super(),B(this,e,mt,dt,c,["post","session","content"])}}function gt(e,t,n){const o=Object.create(e);return o.post=t[n],o}function $t(e){var t,n=new ht({props:{post:e.post,session:e.session,content:e.content}});return{c(){n.$$.fragment.c()},m(e,o){F(n,e,o),t=!0},p(e,t){var o={};e.posts&&(o.post=t.post),e.session&&(o.session=t.session),e.content&&(o.content=t.content),n.$set(o)},i(e){t||(E(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){q(n,e)}}}function bt(e){var t,n,o,s,r=e.homeUrl&&vt(e),c=e.prevUrl&&kt(e),u=e.page&&yt(e),p=e.nextUrl&&wt(e);return{c(){t=f("div"),r&&r.c(),n=m(),c&&c.c(),o=m(),u&&u.c(),s=m(),p&&p.c(),b(t,"class","navigation")},m(e,a){i(e,t,a),r&&r.m(t,null),l(t,n),c&&c.m(t,null),l(t,o),u&&u.m(t,null),l(t,s),p&&p.m(t,null)},p(e,l){l.homeUrl?r||((r=vt(l)).c(),r.m(t,n)):r&&(r.d(1),r=null),l.prevUrl?c||((c=kt(l)).c(),c.m(t,o)):c&&(c.d(1),c=null),l.page?u?u.p(e,l):((u=yt(l)).c(),u.m(t,s)):u&&(u.d(1),u=null),l.nextUrl?p||((p=wt(l)).c(),p.m(t,null)):p&&(p.d(1),p=null)},d(e){e&&a(t),r&&r.d(),c&&c.d(),u&&u.d(),p&&p.d()}}}function vt(e){var t,n;return{c(){(t=f("span")).textContent="First",n=g(t,"click",e.click_handler)},m(e,n){i(e,t,n)},d(e){e&&a(t),n()}}}function kt(e){var t,n;return{c(){(t=f("span")).textContent="Previous",n=g(t,"click",e.click_handler_1)},m(e,n){i(e,t,n)},d(e){e&&a(t),n()}}}function yt(e){var t,n;return{c(){t=f("b"),n=d(e.page)},m(e,o){i(e,t,o),l(t,n)},p(e,t){e.page&&v(n,t.page)},d(e){e&&a(t)}}}function wt(e){var t,n;return{c(){(t=f("span")).textContent="Next",n=g(t,"click",e.click_handler_2)},m(e,n){i(e,t,n)},d(e){e&&a(t),n()}}}function Rt(e){for(var t,n,o,s,r=e.posts,c=[],u=0;u<r.length;u+=1)c[u]=$t(gt(e,r,u));const l=e=>J(c[e],1,1,()=>{c[e]=null});var d=(e.homeUrl||e.prevUrl||e.nextUrl)&&bt(e);return{c(){t=f("ul");for(var e=0;e<c.length;e+=1)c[e].c();n=m(),d&&d.c(),o=h(),b(t,"class","post-list")},m(e,r){i(e,t,r);for(var u=0;u<c.length;u+=1)c[u].m(t,null);i(e,n,r),d&&d.m(e,r),i(e,o,r),s=!0},p(e,n){if(e.posts||e.session||e.content){r=n.posts;for(var s=0;s<r.length;s+=1){const o=gt(n,r,s);c[s]?(c[s].p(e,o),E(c[s],1)):(c[s]=$t(o),c[s].c(),E(c[s],1),c[s].m(t,null))}for(C(),s=r.length;s<c.length;s+=1)l(s);I()}n.homeUrl||n.prevUrl||n.nextUrl?d?d.p(e,n):((d=bt(n)).c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null)},i(e){if(!s){for(var t=0;t<r.length;t+=1)E(c[t]);s=!0}},o(e){c=c.filter(Boolean);for(let e=0;e<c.length;e+=1)J(c[e]);s=!1},d(e){e&&a(t),p(c,e),e&&a(n),d&&d.d(e),e&&a(o)}}}function xt(e,t,n){let o,{collection:s,session:r,content:c}=t;u(e,r,e=>{n("$session",o=e)});let l,i,a,p,f=pubgate_instance;const d=async e=>{let t=e.split("?"),r=t.shift();f&&t.push("cached=1"),n("collection",s=await ne(`${r}?${t.join("&")}`,o))};let m;return e.$set=(e=>{"collection"in e&&n("collection",s=e.collection),"session"in e&&n("session",r=e.session),"content"in e&&n("content",c=e.content)}),e.$$.update=((e={collection:1})=>{e.collection&&n("posts",m=(e=>{let t=/page=(\d+)$/.exec(e.id);return n("page",p=t?parseInt(t[1]):1),n("homeUrl",l=p>1&&e.partOf?e.partOf:null),n("prevUrl",i=p>1?`${l}?page=${p-1}`:null),n("nextUrl",a=e.next),e.first&&e.totalItems===e.first.totalItems&&n("nextUrl",a=null),e.first?e.first.orderedItems:e.orderedItems})(s))}),{collection:s,session:r,content:c,homeUrl:l,prevUrl:i,nextUrl:a,page:p,selectPage:d,posts:m,click_handler:function(){return d(l)},click_handler_1:function(){return d(i)},click_handler_2:function(){return d(a)}}}class _t extends W{constructor(e){super(),B(this,e,xt,Rt,c,["collection","session","content"])}}function Tt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function jt(e){var t,n=new _t({props:{collection:e.collection,session:e.session,content:Pt}});return{c(){n.$$.fragment.c()},m(e,o){F(n,e,o),t=!0},p(e,t){var o={};e.timeline&&(o.collection=t.collection),e.session&&(o.session=t.session),e.content&&(o.content=Pt),n.$set(o)},i(e){t||(E(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){q(n,e)}}}function St(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Nt(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:St,then:jt,catch:Tt,value:"collection",error:"null",blocks:[,,,]};return D(o=e.timeline,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,"timeline"in n&&o!==(o=e.timeline)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(E(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){J(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}let Pt="timeline";function Ot(e,t,n){let o,s,{curRoute:r}=t;u(e,r,e=>{n("$curRoute",o=e)});let{session:c}=t;u(e,c,e=>{n("$session",s=e)});let l=pubgate_instance;let i;return e.$set=(e=>{"curRoute"in e&&n("curRoute",r=e.curRoute),"session"in e&&n("session",c=e.session)}),e.$$.update=((e={$curRoute:1,$session:1})=>{(e.$curRoute||e.$session)&&n("timeline",i=function(e,t){switch(e){case"/local":return l?ne(base_url+"/timeline/local?cached=1"):[];case"/federated":return l?ne(base_url+"/timeline/federated?cached=1"):[];case"/inbox":return t.user?l?ne(t.user.inbox+"?cached=1",t,!0):ne(t.user.inbox,t):[];case"/profile":return ne(l?t.user.outbox+"?cached=1":t.user.outbox);default:return[]}}(o,s))}),{curRoute:r,session:c,timeline:i}}class Lt extends W{constructor(e){super(),B(this,e,Ot,Nt,c,["curRoute","session"])}}function At(e){var t,n,o,s,r,c,u,p,$,k,y=e.profile.name,w=e.profile.summary;function R(e){return e.following?Ct:Ut}var x=R(e),_=x(e),T=e.outbox_collection&&It(e);return{c(){t=f("h2"),n=d(y),o=m(),s=f("button"),_.c(),r=m(),c=d(w),u=m(),T&&T.c(),p=h(),b(s,"class","btn btn-sm pull-xs-right btn-info"),k=g(s,"click",e.follow)},m(e,a){i(e,t,a),l(t,n),l(t,o),l(t,s),_.m(s,null),i(e,r,a),i(e,c,a),i(e,u,a),T&&T.m(e,a),i(e,p,a),$=!0},p(e,t){$&&!e.profile||y===(y=t.profile.name)||v(n,y),x!==(x=R(t))&&(_.d(1),(_=x(t))&&(_.c(),_.m(s,null))),$&&!e.profile||w===(w=t.profile.summary)||v(c,w),t.outbox_collection?T?(T.p(e,t),E(T,1)):((T=It(t)).c(),E(T,1),T.m(p.parentNode,p)):T&&(C(),J(T,1,1,()=>{T=null}),I())},i(e){$||(E(T),$=!0)},o(e){J(T),$=!1},d(e){e&&a(t),_.d(),e&&(a(r),a(c),a(u)),T&&T.d(e),e&&a(p),k()}}}function Ut(e){var t;return{c(){t=d("Follow")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function Ct(e){var t;return{c(){t=d("Unfollow")},m(e,n){i(e,t,n)},d(e){e&&a(t)}}}function It(e){var t,n=new _t({props:{session:e.session,collection:e.outbox_collection}});return{c(){n.$$.fragment.c()},m(e,o){F(n,e,o),t=!0},p(e,t){var o={};e.session&&(o.session=t.session),e.outbox_collection&&(o.collection=t.outbox_collection),n.$set(o)},i(e){t||(E(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){q(n,e)}}}function Et(e){var t,n=new ut({props:{post:e.loadedPost,session:e.session}});return{c(){n.$$.fragment.c()},m(e,o){F(n,e,o),t=!0},p(e,t){var o={};e.loadedPost&&(o.post=t.loadedPost),e.session&&(o.session=t.session),n.$set(o)},i(e){t||(E(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){q(n,e)}}}function Jt(e){var t,n,o,r,c,u,p,h,k,y,w,R,x,_,T,j,S,N,P,O,L,A,U,D,F,q,z,B,W,H,M,G,Y=e.profile&&At(e),Z="object"==typeof e.loadedPost&&Et(e);return{c(){t=f("br"),n=d("\nSearch accounts\n"),o=f("form"),r=f("fieldset"),c=f("input"),u=m(),p=f("button"),h=d("Search user"),y=m(),w=f("br"),R=m(),x=f("br"),_=d("\nLoad Post by link\n"),T=f("form"),j=f("fieldset"),S=f("input"),N=m(),P=f("button"),O=d("Load post"),A=m(),U=f("br"),D=m(),F=f("br"),q=m(),Y&&Y.c(),z=m(),Z&&Z.c(),B=m(),W=f("p"),H=d(e.error),b(c,"class","form-control form-control-lg"),b(c,"type","text"),b(c,"placeholder","Search format: username@domain"),b(r,"class","form-group"),b(p,"class","btn btn-sm pull-xs-right btn-info"),b(p,"type","submit"),p.disabled=k=!e.username,b(S,"class","form-control form-control-lg"),b(S,"type","text"),b(S,"placeholder","Copy a link here"),b(j,"class","form-group"),b(P,"class","btn btn-sm pull-xs-right btn-info"),b(P,"type","submit"),P.disabled=L=!e.postLink,b(W,"class","text-danger"),G=[g(c,"input",e.input0_input_handler),g(o,"submit",$(e.search)),g(S,"input",e.input1_input_handler),g(T,"submit",$(e.loadPost))]},m(s,a){i(s,t,a),i(s,n,a),i(s,o,a),l(o,r),l(r,c),c.value=e.username,l(o,u),l(o,p),l(p,h),i(s,y,a),i(s,w,a),i(s,R,a),i(s,x,a),i(s,_,a),i(s,T,a),l(T,j),l(j,S),S.value=e.postLink,l(T,N),l(T,P),l(P,O),i(s,A,a),i(s,U,a),i(s,D,a),i(s,F,a),i(s,q,a),Y&&Y.m(s,a),i(s,z,a),Z&&Z.m(s,a),i(s,B,a),i(s,W,a),l(W,H),M=!0},p(e,t){e.username&&c.value!==t.username&&(c.value=t.username),M&&!e.username||k===(k=!t.username)||(p.disabled=k),e.postLink&&S.value!==t.postLink&&(S.value=t.postLink),M&&!e.postLink||L===(L=!t.postLink)||(P.disabled=L),t.profile?Y?(Y.p(e,t),E(Y,1)):((Y=At(t)).c(),E(Y,1),Y.m(z.parentNode,z)):Y&&(C(),J(Y,1,1,()=>{Y=null}),I()),"object"==typeof t.loadedPost?Z?(Z.p(e,t),E(Z,1)):((Z=Et(t)).c(),E(Z,1),Z.m(B.parentNode,B)):Z&&(C(),J(Z,1,1,()=>{Z=null}),I()),M&&!e.error||v(H,t.error)},i(e){M||(E(Y),E(Z),M=!0)},o(e){J(Y),J(Z),M=!1},d(e){e&&(a(t),a(n),a(o),a(y),a(w),a(R),a(x),a(_),a(T),a(A),a(U),a(D),a(F),a(q)),Y&&Y.d(e),e&&a(z),Z&&Z.d(e),e&&(a(B),a(W)),s(G)}}}function Dt(e,t,n){let o,{session:s,curRoute:r}=t;u(e,s,e=>{n("$session",o=e)});let c="",l=null,i=!1,a=null,p="",f="",d="";const m=async e=>{const t=await e;return t?t.error&&n("error",d=t.error):n("error",d="Empty response."),t};return e.$set=(e=>{"session"in e&&n("session",s=e.session),"curRoute"in e&&n("curRoute",r=e.curRoute)}),{session:s,curRoute:r,username:c,profile:l,following:i,outbox_collection:a,loadedPost:p,postLink:f,error:d,search:async e=>{let t,o;if(n("error",d=""),n("profile",l=null),n("outbox_collection",a=null),c.match(/^http/))return void n("error",d="we could do the request for you, but we don't");const s=c.split("@");if(2!==s.length){var r=d="Use this format: username@domain";return n("error",d),r}t=s[0],o=s[1];const u=await m(ue(t,o));u.outbox&&(n("profile",l=u),n("outbox_collection",a="string"==typeof l.outbox?await m(ie(l.outbox)):l.outbox))},follow:async e=>{const t=e.target.innerText,{id:s,name:r}=l;if(o.user){if(pubgate_instance){const e=JSON.stringify({type:t,object:s}),c={Authorization:"Bearer "+o.token},u=o.user.outbox,l={method:"POST",body:e,headers:c},a=await fetch(u,l).then(e=>e.json());a?"success"===a.Created?n("following",i="Follow"===t):a.error?"This user is already followed"===a.error?n("following",i=!0):n("error",d=JSON.stringify(a.error)):n("error",d="Something went wrong."):n("error",d=`Empty response trying to ${t} ${r}`)}}else n("error",d="You are not logged in.")},loadPost:async function(e){n("error",d=p=""),n("loadedPost",p);try{const e=await te(f),{type:o}=e;if("Note"!==o){var t=d=`Wrong type: ${o}`;return n("error",d),t}n("loadedPost",p=e),n("postLink",f="")}catch(e){n("error",d=e.message)}},input0_input_handler:function(){c=this.value,n("username",c)},input1_input_handler:function(){f=this.value,n("postLink",f)}}}function Ft(t){var n,o,r,c,u,p,h,k,y,w,R,x,_,T,j,S,N,P,O,L,A,U,C,I,E,J,D,F,q,z,B,W,H,M,G,Y,Z,K,Q,V,X,ee;return{c(){(n=f("div")).textContent="Sign-in ( ActivityPub compatible, OAuth2 password grant )",o=m(),r=f("form"),c=f("fieldset"),u=f("input"),p=m(),h=f("fieldset"),k=f("input"),y=m(),w=f("button"),R=d("Sign in"),_=m(),T=f("br"),j=m(),S=f("div"),N=d(t.error),P=m(),O=f("br"),L=d("\n  or register ( PubGate only )\n  "),A=f("br"),U=m(),C=f("form"),I=f("fieldset"),E=f("input"),J=m(),D=f("fieldset"),F=f("input"),q=m(),z=f("fieldset"),B=f("textarea"),W=m(),H=f("fieldset"),M=f("input"),G=m(),Y=f("fieldset"),Z=f("input"),K=m(),Q=f("button"),V=d("Register"),b(n,"class","form-group"),b(u,"class","form-control form-control-lg"),b(u,"type","username"),b(u,"placeholder","Username"),b(c,"class","form-group"),b(k,"class","form-control form-control-lg"),b(k,"type","password"),b(k,"placeholder","Password"),b(h,"class","form-group"),b(w,"class","btn btn-sm pull-xs-right btn-info"),b(w,"type","submit"),w.disabled=x=!t.username||!t.password,b(S,"class","text-danger"),b(E,"class","form-control form-control-lg"),b(E,"type","text"),b(E,"placeholder","Username"),b(I,"class","form-group"),b(F,"class","form-control form-control-lg"),b(F,"type","password"),b(F,"placeholder","Password"),b(D,"class","form-group"),b(B,"class","form-control"),b(B,"rows","8"),b(B,"placeholder","Profile Description"),b(z,"class","form-group"),b(M,"class","form-control form-control-lg"),b(M,"type","text"),b(M,"placeholder","Avatar URL"),b(H,"class","form-group"),b(Z,"class","form-control form-control-lg"),b(Z,"type","text"),b(Z,"placeholder","Invite code"),b(Y,"class","form-group"),b(Q,"class","btn btn-sm pull-xs-right btn-info"),b(Q,"type","submit"),Q.disabled=X=!t.username||!t.password,ee=[g(u,"input",t.input0_input_handler),g(k,"input",t.input1_input_handler),g(r,"submit",$(t.login)),g(E,"input",t.input2_input_handler),g(F,"input",t.input3_input_handler),g(B,"input",t.textarea_input_handler),g(M,"input",t.input4_input_handler),g(Z,"input",t.input5_input_handler),g(C,"submit",$(t.register))]},m(e,s){i(e,n,s),i(e,o,s),i(e,r,s),l(r,c),l(c,u),u.value=t.username,l(r,p),l(r,h),l(h,k),k.value=t.password,l(r,y),l(r,w),l(w,R),i(e,_,s),i(e,T,s),i(e,j,s),i(e,S,s),l(S,N),i(e,P,s),i(e,O,s),i(e,L,s),i(e,A,s),i(e,U,s),i(e,C,s),l(C,I),l(I,E),E.value=t.username,l(C,J),l(C,D),l(D,F),F.value=t.password,l(C,q),l(C,z),l(z,B),B.value=t.description,l(C,W),l(C,H),l(H,M),M.value=t.avatar,l(C,G),l(C,Y),l(Y,Z),Z.value=t.invite,l(C,K),l(C,Q),l(Q,V)},p(e,t){e.username&&(u.value=t.username),e.password&&k.value!==t.password&&(k.value=t.password),(e.username||e.password)&&x!==(x=!t.username||!t.password)&&(w.disabled=x),e.error&&v(N,t.error),e.username&&E.value!==t.username&&(E.value=t.username),e.password&&F.value!==t.password&&(F.value=t.password),e.description&&(B.value=t.description),e.avatar&&M.value!==t.avatar&&(M.value=t.avatar),e.invite&&Z.value!==t.invite&&(Z.value=t.invite),(e.username||e.password)&&X!==(X=!t.username||!t.password)&&(Q.disabled=X)},i:e,o:e,d(e){e&&(a(n),a(o),a(r),a(_),a(T),a(j),a(S),a(P),a(O),a(L),a(A),a(U),a(C)),s(ee)}}}function qt(e){var t,n,o,s,r,c,u,p,h,$,k,y=e.$session.user.name,w=e.$session.user.summary,R=new Lt({props:{curRoute:e.curRoute,session:e.session}});return{c(){t=f("h2"),n=f("a"),o=d(y),r=m(),(c=f("button")).textContent="Logout",u=m(),p=d(w),h=m(),R.$$.fragment.c(),b(n,"href",s=e.$session.user.url),b(c,"class","btn btn-sm pull-xs-right btn-info"),k=g(c,"click",e.logout)},m(e,s){i(e,t,s),l(t,n),l(n,o),l(t,r),l(t,c),i(e,u,s),i(e,p,s),i(e,h,s),F(R,e,s),$=!0},p(e,t){$&&!e.$session||y===(y=t.$session.user.name)||v(o,y),$&&!e.$session||s===(s=t.$session.user.url)||b(n,"href",s),$&&!e.$session||w===(w=t.$session.user.summary)||v(p,w);var r={};e.curRoute&&(r.curRoute=t.curRoute),e.session&&(r.session=t.session),R.$set(r)},i(e){$||(E(R.$$.fragment,e),$=!0)},o(e){J(R.$$.fragment,e),$=!1},d(e){e&&(a(t),a(u),a(p),a(h)),q(R,e),k()}}}function zt(e){var t,n,o,s,r=[qt,Ft],c=[];function u(e){return e.$session.user?0:1}return t=u(e),n=c[t]=r[t](e),{c(){n.c(),o=h()},m(e,n){c[t].m(e,n),i(e,o,n),s=!0},p(e,s){var l=t;(t=u(s))===l?c[t].p(e,s):(C(),J(c[l],1,1,()=>{c[l]=null}),I(),(n=c[t])||(n=c[t]=r[t](s)).c(),E(n,1),n.m(o.parentNode,o))},i(e){s||(E(n),s=!0)},o(e){J(n),s=!1},d(e){c[t].d(e),e&&a(o)}}}function Bt(e,t,n){let o;const s=R();let{curRoute:r,session:c}=t;u(e,c,e=>{n("$session",o=e)});let l="",i="",a="",p="",f="",d="";async function m(e){const t=await te(base_url+"/@"+l).catch(e=>{console.log(e)});if(!t)return void n("error",d="login failed");const r=await te(t.endpoints.oauthTokenEndpoint,{method:"POST",body:JSON.stringify({username:l,password:i})});if(r.access_token){let e=o;e.user=t,e.token=r.access_token,s("updatesession",e)}}return e.$set=(e=>{"curRoute"in e&&n("curRoute",r=e.curRoute),"session"in e&&n("session",c=e.session)}),{curRoute:r,session:c,username:l,password:i,description:a,avatar:p,invite:f,error:d,login:m,logout:async function(e){s("updatesession",{})},register:async function(e){let t={username:l,password:i,invite:f,profile:{type:"Person",name:l,summary:a,icon:{type:"Image",mediaType:"image/jpeg",url:p}}};(await fetch(base_url+"/user",{method:"POST",body:JSON.stringify(t)}).then(e=>e.json())).profile&&await m()},$session:o,input0_input_handler:function(){l=this.value,n("username",l)},input1_input_handler:function(){i=this.value,n("password",i)},input2_input_handler:function(){l=this.value,n("username",l)},input3_input_handler:function(){i=this.value,n("password",i)},textarea_input_handler:function(){a=this.value,n("description",a)},input4_input_handler:function(){p=this.value,n("avatar",p)},input5_input_handler:function(){f=this.value,n("invite",f)}}}function Wt(t){var n;return{c(){n=d("Minimalist blogging ActivityPub client made with Svelte Could be deployed as\nextension for PubGate, or connected to remote instance Github repo\nhttps://github.com/autogestion/pubgate-philip")},m(e,t){i(e,n,t)},p:e,i:e,o:e,d(e){e&&a(n)}}}function Ht(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Mt(e){var n,o,s,r,c,u,p,g,$,k,y,w,R,x,_,T,j,S,N,P,O,L,A,U,C,I,F,q,z,B,W,H,M,G,Y=e.user.name,Z=e.user.summary;let K={ctx:e,current:null,token:null,pending:Kt,then:Yt,catch:Gt,value:"collection",error:"null",blocks:[,,,]};D(I=e.followers,K);let Q={ctx:e,current:null,token:null,pending:en,then:Vt,catch:Qt,value:"collection",error:"null",blocks:[,,,]};D(q=e.following,Q);let V={ctx:e,current:null,token:null,pending:sn,then:nn,catch:tn,value:"collection",error:"null",blocks:[,,,]};D(B=e.liked,V);let X={ctx:e,current:null,token:null,pending:un,then:cn,catch:rn,value:"collection",error:"null",blocks:[,,,]};return D(M=e.outbox,X),{c(){n=f("h2"),o=f("a"),s=d(Y),c=m(),u=f("p"),p=f("a"),g=d("Followers"),k=d("\n    |\n    "),y=f("a"),w=d("Following"),x=d("\n    |\n    "),_=f("a"),T=d("Timeline"),S=d("\n    |\n    "),N=f("a"),P=d("Liked"),L=m(),A=f("p"),U=d(Z),C=m(),K.block.c(),F=m(),Q.block.c(),z=m(),V.block.c(),W=m(),H=h(),X.block.c(),b(o,"href",r=e.user.url),b(p,"href",$=e.user.followers),b(y,"href",R=e.user.following),b(_,"href",j=e.user.outbox),b(N,"href",O=e.user.liked)},m(e,t){i(e,n,t),l(n,o),l(o,s),i(e,c,t),i(e,u,t),l(u,p),l(p,g),l(u,k),l(u,y),l(y,w),l(u,x),l(u,_),l(_,T),l(u,S),l(u,N),l(N,P),i(e,L,t),i(e,A,t),l(A,U),i(e,C,t),K.block.m(e,K.anchor=t),K.mount=(()=>F.parentNode),K.anchor=F,i(e,F,t),Q.block.m(e,Q.anchor=t),Q.mount=(()=>z.parentNode),Q.anchor=z,i(e,z,t),V.block.m(e,V.anchor=t),V.mount=(()=>W.parentNode),V.anchor=W,i(e,W,t),i(e,H,t),X.block.m(e,X.anchor=t),X.mount=(()=>H.parentNode),X.anchor=H,G=!0},p(n,c){e=c,G&&!n.profile||Y===(Y=e.user.name)||v(s,Y),G&&!n.profile||r===(r=e.user.url)||b(o,"href",r),G&&!n.profile||$===($=e.user.followers)||b(p,"href",$),G&&!n.profile||R===(R=e.user.following)||b(y,"href",R),G&&!n.profile||j===(j=e.user.outbox)||b(_,"href",j),G&&!n.profile||O===(O=e.user.liked)||b(N,"href",O),G&&!n.profile||Z===(Z=e.user.summary)||v(U,Z),K.ctx=e,"followers"in n&&I!==(I=e.followers)&&D(I,K)||K.block.p(n,t(t({},e),K.resolved)),Q.ctx=e,"following"in n&&q!==(q=e.following)&&D(q,Q)||Q.block.p(n,t(t({},e),Q.resolved)),V.ctx=e,"liked"in n&&B!==(B=e.liked)&&D(B,V)||V.block.p(n,t(t({},e),V.resolved)),X.ctx=e,"outbox"in n&&M!==(M=e.outbox)&&D(M,X)||X.block.p(n,t(t({},e),X.resolved))},i(e){G||(E(K.block),E(Q.block),E(V.block),E(X.block),G=!0)},o(e){for(let e=0;e<3;e+=1){J(K.blocks[e])}for(let e=0;e<3;e+=1){J(Q.blocks[e])}for(let e=0;e<3;e+=1){J(V.blocks[e])}for(let e=0;e<3;e+=1){J(X.blocks[e])}G=!1},d(e){e&&(a(n),a(c),a(u),a(L),a(A),a(C)),K.block.d(e),K.token=null,K=null,e&&a(F),Q.block.d(e),Q.token=null,Q=null,e&&a(z),V.block.d(e),V.token=null,V=null,e&&(a(W),a(H)),X.block.d(e),X.token=null,X=null}}}function Gt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Yt(e){var t,n,o=e.collection.length&&Zt(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.length?o?(o.p(e,n),E(o,1)):((o=Zt(n)).c(),E(o,1),o.m(t.parentNode,t)):o&&(C(),J(o,1,1,()=>{o=null}),I())},i(e){n||(E(o),n=!0)},o(e){J(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function Zt(e){var t,n,o,s=new _t({props:{session:e.session,collection:e.collection}});return{c(){(t=f("h3")).textContent="Followers",n=m(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),F(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.followers&&(n.collection=t.collection),s.$set(n)},i(e){o||(E(s.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),q(s,e)}}}function Kt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Qt(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function Vt(e){var t,n,o=e.collection.length&&Xt(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.length?o?(o.p(e,n),E(o,1)):((o=Xt(n)).c(),E(o,1),o.m(t.parentNode,t)):o&&(C(),J(o,1,1,()=>{o=null}),I())},i(e){n||(E(o),n=!0)},o(e){J(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function Xt(e){var t,n,o,s=new _t({props:{session:e.session,collection:e.collection}});return{c(){(t=f("h3")).textContent="Following",n=m(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),F(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.following&&(n.collection=t.collection),s.$set(n)},i(e){o||(E(s.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),q(s,e)}}}function en(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function tn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function nn(e){var t,n,o=e.collection.length&&on(e);return{c(){o&&o.c(),t=h()},m(e,s){o&&o.m(e,s),i(e,t,s),n=!0},p(e,n){n.collection.length?o?(o.p(e,n),E(o,1)):((o=on(n)).c(),E(o,1),o.m(t.parentNode,t)):o&&(C(),J(o,1,1,()=>{o=null}),I())},i(e){n||(E(o),n=!0)},o(e){J(o),n=!1},d(e){o&&o.d(e),e&&a(t)}}}function on(e){var t,n,o,s=new _t({props:{session:e.session,collection:e.collection}});return{c(){(t=f("h3")).textContent="Liked",n=m(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),F(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.liked&&(n.collection=t.collection),s.$set(n)},i(e){o||(E(s.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),q(s,e)}}}function sn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function rn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function cn(e){var t,n,o,s=new _t({props:{session:e.session,collection:e.collection}});return{c(){(t=f("h3")).textContent="Posts",n=m(),s.$$.fragment.c()},m(e,r){i(e,t,r),i(e,n,r),F(s,e,r),o=!0},p(e,t){var n={};e.session&&(n.session=t.session),e.outbox&&(n.collection=t.collection),s.$set(n)},i(e){o||(E(s.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),o=!1},d(e){e&&(a(t),a(n)),q(s,e)}}}function un(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function ln(t){var n,o,s;return{c(){n=d("Shortly this page will show info about\n  "),o=f("b"),s=d(t.username)},m(e,t){i(e,n,t),i(e,o,t),l(o,s)},p:e,i:e,o:e,d(e){e&&(a(n),a(o))}}}function an(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:ln,then:Mt,catch:Ht,value:"user",error:"null",blocks:[,,,]};return D(o=e.profile,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,"profile"in n&&o!==(o=e.profile)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(E(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){J(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}function pn(e,t,n){let o,{curRoute:s,session:r}=t;u(e,s,e=>{n("$curRoute",o=e)});const c=o.match(/^\/@([^\/]+)$/)[1];let l,i,a,p,f={Accept:"application/activity+json"};const d=(e,t=(e=>e))=>fetch(e,{headers:f}).then(e=>e.json()).then(t);let m;return e.$set=(e=>{"curRoute"in e&&n("curRoute",s=e.curRoute),"session"in e&&n("session",r=e.session)}),e.$$.update=((e={$curRoute:1})=>{e.$curRoute&&n("profile",m=(e=>fetch(base_url+e,{headers:f}).then(e=>e.json()).then(e=>(console.log("[User]Fetching timeline",e.outbox),n("outbox",l=d(e.outbox,e=>e)),n("followers",i=d(e.followers)),n("following",a=d(e.following)),n("liked",p=d(e.liked)),e)))(o))}),{curRoute:s,session:r,username:c,outbox:l,followers:i,following:a,liked:p,profile:m}}function fn(t){return{c:e,m:e,p:e,i:e,o:e,d:e}}function dn(e){var t,n=new ut({props:{post:e.post,session:e.session}});return{c(){n.$$.fragment.c()},m(e,o){F(n,e,o),t=!0},p(e,t){var o={};e.object&&(o.post=t.post),e.session&&(o.session=t.session),n.$set(o)},i(e){t||(E(n.$$.fragment,e),t=!0)},o(e){J(n.$$.fragment,e),t=!1},d(e){q(n,e)}}}function mn(t){var n,o,s;return{c(){n=d("So you want to see object "),o=d(t.id),s=d("?")},m(e,t){i(e,n,t),i(e,o,t),i(e,s,t)},p:e,i:e,o:e,d(e){e&&(a(n),a(o),a(s))}}}function hn(e){var n,o,s;let r={ctx:e,current:null,token:null,pending:mn,then:dn,catch:fn,value:"post",error:"null",blocks:[,,,]};return D(o=e.object,r),{c(){n=h(),r.block.c()},m(e,t){i(e,n,t),r.block.m(e,r.anchor=t),r.mount=(()=>n.parentNode),r.anchor=n,s=!0},p(n,s){e=s,r.ctx=e,"object"in n&&o!==(o=e.object)&&D(o,r)||r.block.p(n,t(t({},e),r.resolved))},i(e){s||(E(r.block),s=!0)},o(e){for(let e=0;e<3;e+=1){J(r.blocks[e])}s=!1},d(e){e&&a(n),r.block.d(e),r.token=null,r=null}}}function gn(e,t,n){let o,s,{curRoute:r}=t;u(e,r,e=>{n("$curRoute",o=e)});let{session:c}=t;u(e,c,e=>{n("$session",s=e)});let l=pubgate_instance,i=o.match(/^\/@([^\/]+)\/object\/(.+)$/)[2];let a;return e.$set=(e=>{"curRoute"in e&&n("curRoute",r=e.curRoute),"session"in e&&n("session",c=e.session)}),e.$$.update=((e={$curRoute:1,$session:1})=>{(e.$curRoute||e.$session)&&n("object",a=function(e,t={}){return fetch(base_url+(l?e+"?cached=1":e),{headers:{Accept:"application/activity+json"}}).then(e=>e.json()).then(e=>e)}(o,s))}),{curRoute:r,session:c,id:i,object:a}}function $n(t){var n,o,s;return{c(){n=d("You wanted to see "),o=d(t.$curRoute),s=d(" but we don't have it :/")},m(e,t){i(e,n,t),i(e,o,t),i(e,s,t)},p(e,t){e.$curRoute&&v(o,t.$curRoute)},i:e,o:e,d(e){e&&(a(n),a(o),a(s))}}}function bn(e,t,n){let o,{curRoute:s,session:r}=t;return u(e,s,e=>{n("$curRoute",o=e)}),e.$set=(e=>{"curRoute"in e&&n("curRoute",s=e.curRoute),"session"in e&&n("session",r=e.session)}),{curRoute:s,session:r,$curRoute:o}}const vn=[];function kn(t,n=e){let o;const s=[];function r(e){if(c(t,e)&&(t=e,o)){const e=!vn.length;for(let e=0;e<s.length;e+=1){const n=s[e];n[1](),vn.push(n,t)}if(e){for(let e=0;e<vn.length;e+=2)vn[e][0](vn[e+1]);vn.length=0}}}return{set:r,update:function(e){r(e(t))},subscribe:function(c,u=e){const l=[c,u];return s.push(l),1===s.length&&(o=n(r)||e),c(t),()=>{const e=s.indexOf(l);-1!==e&&s.splice(e,1),0===s.length&&(o(),o=null)}}}}const yn=kn(window.location.pathname),wn={"/local":{name:"Local Timeline",component:Lt},"/federated":{name:"Federated Timeline",component:Lt},"/create":{name:"Create",component:Ee},"/search":{name:"Search",component:class extends W{constructor(e){super(),B(this,e,Dt,Jt,c,["session","curRoute"])}}},"/inbox":{name:"Inbox",component:Lt},"/profile":{name:"Profile",component:class extends W{constructor(e){super(),B(this,e,Bt,zt,c,["curRoute","session"])}}},"/about":{name:"About",component:class extends W{constructor(e){super(),B(this,e,null,Wt,c,[])}}},user:{component:class extends W{constructor(e){super(),B(this,e,pn,an,c,["curRoute","session"])}}},object:{component:class extends W{constructor(e){super(),B(this,e,gn,hn,c,["curRoute","session"])}}},error:{component:class extends W{constructor(e){super(),B(this,e,bn,$n,c,["curRoute","session"])}}}},Rn=kn({});function xn(e){var t,n,o=e.component;function s(e){return{props:{curRoute:e.curRoute,session:e.session}}}if(o){var r=new o(s(e));r.$on("updatesession",e.updateSession)}return{c(){t=f("div"),r&&r.$$.fragment.c(),b(t,"class","content")},m(e,o){i(e,t,o),r&&F(r,t,null),n=!0},p(e,n){var c={};if(e.curRoute&&(c.curRoute=n.curRoute),e.session&&(c.session=n.session),o!==(o=n.component)){if(r){C();const e=r;J(e.$$.fragment,1,0,()=>{q(e,1)}),I()}o?((r=new o(s(n))).$on("updatesession",n.updateSession),r.$$.fragment.c(),E(r.$$.fragment,1),F(r,t,null)):r=null}else o&&r.$set(c)},i(e){n||(r&&E(r.$$.fragment,e),n=!0)},o(e){r&&J(r.$$.fragment,e),n=!1},d(e){e&&a(t),r&&q(r)}}}function _n(e,t,n){let o,{routes:s,curRoute:r}=t;u(e,r,e=>{n("$curRoute",o=e)}),"/"===o&&r.set("/local");let c,{updateSession:l,session:i}=t;return w(r.subscribe(e=>{const t=s[o];let r=o.match(/^\/@([^\/]+)\/object\/(.+)$/),u=o.match(/^\/@([^\/]+)\/?$/);t?n("component",c=t.component):r?n("component",c=s.object.component):u&&n("component",c=s.user.component),c||n("component",c=s.error.component)})),e.$set=(e=>{"routes"in e&&n("routes",s=e.routes),"curRoute"in e&&n("curRoute",r=e.curRoute),"updateSession"in e&&n("updateSession",l=e.updateSession),"session"in e&&n("session",i=e.session)}),{routes:s,curRoute:r,updateSession:l,session:i,component:c}}class Tn extends W{constructor(e){super(),B(this,e,_n,xn,c,["routes","curRoute","updateSession","session"])}}function jn(e){var t,n,o,s=new V({props:{routes:wn,curRoute:yn,selectTab:Sn,session:Rn,pgi:e.pgi}}),r=new Tn({props:{routes:wn,curRoute:yn,session:Rn,updateSession:e.updateSession}}),c=new ee({});return{c(){s.$$.fragment.c(),t=m(),r.$$.fragment.c(),n=m(),c.$$.fragment.c()},m(e,u){F(s,e,u),i(e,t,u),F(r,e,u),i(e,n,u),F(c,e,u),o=!0},p(e,t){var n={};e.routes&&(n.routes=wn),e.curRoute&&(n.curRoute=yn),e.selectTab&&(n.selectTab=Sn),e.session&&(n.session=Rn),e.pgi&&(n.pgi=t.pgi),s.$set(n);var o={};e.routes&&(o.routes=wn),e.curRoute&&(o.curRoute=yn),e.session&&(o.session=Rn),e.updateSession&&(o.updateSession=t.updateSession),r.$set(o)},i(e){o||(E(s.$$.fragment,e),E(r.$$.fragment,e),E(c.$$.fragment,e),o=!0)},o(e){J(s.$$.fragment,e),J(r.$$.fragment,e),J(c.$$.fragment,e),o=!1},d(e){q(s,e),e&&a(t),q(r,e),e&&a(n),q(c,e)}}}function Sn(e){const t=e.pathname;Array.prototype.forEach.call(e.parentNode.parentNode.children,(e,n)=>{e.firstChild.href.split("/")[1]!==t&&e.firstChild.classList.remove("header-selected")}),e.classList.add("header-selected")}function Nn(e,t,n){let o;u(e,Rn,e=>{n("$session",o=e)});let s=pubgate_instance;const r=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))};return Rn.set((e=>JSON.parse(localStorage.getItem(e)))("session")||{}),{pgi:s,updateSession:e=>{Rn.set(e.detail),r("session",o)}}}return new class extends W{constructor(e){super(),B(this,e,Nn,jn,c,[])}}({target:document.body,props:{name:"app"}})}();
//# sourceMappingURL=bundle.js.map
